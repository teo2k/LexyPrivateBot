# LexyPrivateBot

Телеграм-бот для автоматической проверки юридических документов на блоки, связанные с госпошлиной, и поиска рискованных формулировок на основе:

- постановлений Пленума ВС РФ,
- определений КС РФ,
- доктринальных источников.

Бот выделяет фрагменты по теме, ищет релевантные нормы в векторном хранилище (Pinecone), прогоняет через LLM (OpenAI) и помечает каждый фрагмент как **OK** или **Риск** с коротким комментарием и ссылкой на источники.

---

## Основные возможности

- Загрузка документов в Telegram (PDF, DOCX и др.).
- Извлечение текста и разбиение его на смысловые фрагменты.
- Фильтрация фрагментов по теме «госпошлина».
- RAG-поиск по базе знаний (ПП ВС РФ, КС РФ, обзоры, доктрина) через Pinecone.
- Анализ фрагментов через OpenAI (LLM) с ограничением только на загруженные источники.
- Маркировка:  
  - `OK` - фрагмент не содержит очевидных рисков;  
  - `Риск` - потенциально неверные или спорные формулировки.
- Для каждого рискованного фрагмента:
  - краткий комментарий, что именно рискованно;
  - краткая корректная позиция;
  - список использованных источников (ПП ВС РФ / КС РФ / доктрина).

---

## Используемый стек

- **Python 3.10+**
- **aiogram 3** - Telegram-бот
- **OpenAI API** - эмбеддинги и LLM-анализ
- **Pinecone** - векторное хранилище
- **PyPDF2** / **python-docx** - извлечение текста из PDF/DOCX
- **pydantic v2 + pydantic-settings** - конфиги и валидация
- **tqdm** - прогресс-бар при индексации базы знаний

---

## Структура проекта (укрупнённо)

text
LexyPrivateBot/
  app/
    handlers/           # обработчики Telegram-сообщений
    services/           # бизнес-логика: анализ, сплиттер, фильтр, rag-поиск
    integrations/       # openai, pinecone и др. внешние интеграции
    models/             # pydantic-модели для анализа и DTO
    settings.py         # класс Settings (pydantic-settings)
    bot_factory.py      # создание Bot и Dispatcher
  scripts/
    index_knowledge.py  # индексация базы знаний в Pinecone
  data/
    knowledge/          # PDF-файлы с нормами и доктриной (локально, не в git)
  bot.py                # точка входа бота
  README.md
  requirements.txt
  .env                  # секреты (НЕ коммитится)
  .gitignore
Установка и запуск
1. Клонирование и окружение
git clone https://github.com/teo2k/LexyPrivateBot.git
cd LexyPrivateBot

python3 -m venv venv
source venv/bin/activate  # macOS / Linux
# venv\Scripts\activate   # Windows
2. Установка зависимостей
pip install -r requirements.txt
Настройка переменных окружения
Создайте в корне файл .env (он игнорируется git):
OPENAI_API_KEY=sk-...
PINECONE_API_KEY=...
PINECONE_INDEX_NAME=lexy-legal-norms
PINECONE_CLOUD=aws
PINECONE_REGION=us-east-1

BOT_TOKEN=123456789:AA...   # токен Telegram-бота от BotFather
DEBUG=True
Подготовка базы знаний (Pinecone)
Скопируйте PDF-файлы с нормативкой и доктриной в:
data/knowledge/
Запустите индексацию:
python -m scripts.index_knowledge
Скрипт:
извлекает текст из PDF;
режет на чанки (~1800 символов);
для каждого чанка строит эмбеддинг;
отправляет в Pinecone батчами с прогресс-баром и ретраями (tqdm).
При нестабильном интернете:
upsert выполняется с несколькими попытками;
повторный запуск скрипта безопасен (upsert идемпотентен, данные не дублируются по id).
Запуск бота
После успешной индексации:
python bot.py
Далее:
откройте своего бота в Telegram;
отправьте документ (PDF / DOCX) с фрагментами по госпошлине;
бот вернёт список фрагментов с пометками OK / Риск и источниками.
Замечания по безопасности
Файл .env никогда не коммитится (он в .gitignore).
Все ключи (OpenAI, Pinecone, BOT_TOKEN) хранятся только локально и в переменных окружения.
В репозитории нет PDF с реальными судебными актами и доктриной — только код.
